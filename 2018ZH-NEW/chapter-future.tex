\chapter{总结与展望}
\label{chp:future}
\section{总结}


\todo{
背景：\\
贡献总结：\\
系统实现：\\
实验评估：\\
}

本文提出了一个基于GUI的自动化性能测试方法，并通过Java实现了其功能，开发了自动化性能测试框架PerDroid。PerDroid可基本在无人干预的条件下进行性能测试，取得了有意义的研究成果。以下是本文的主要工作：
（1） 本文提出了一个新的针对性能的自动化测试方法，有效结合性能测试和自动化测试，实现自动化的性能测试。并实现了该框架PerDroid，只需要输入apk即可实现自动化测试。
（2） 本文提出了一个对App运行过程中的状态的定义方法，通过对页面文件的详细分析，去除遮挡控件和不可操作控件。由此获得一个尽可能符合用户操作的App状态。
（3） 基于App的状态，我们提出了一个相似度算法，以解决动态执行App出现的状态爆炸的通病。通过相似度算法，我们可以归并相似的状态。目的是为了在保证不丢失状态信息的前提下，尽可能的剪枝App状态，避免路径爆炸。同时也为了有效化历史记录。
（4）我们提出了一个基于状态的随机算法，以解决Monkey随机测试的弊端，使得框架更迅速的遍历到App的各个状态。本算法充分考虑到历史测试行为和测试探索到的后驱页面复杂度，即可以通过随机的方式增加测试序列的多样性，也可充分考虑部分模块需要多次测试的情况。实验结果证明了这一方法的有效性。
（5） 针对Monkey无法应对输入框的问题，本文提出了通过划分等价类，随机输入不同的内容尝试使得App继续运行，在本文中，也可以手动设置输入框内容，以解决特定App在某些情况下需要特定输入内容才能继续执行后续逻辑的问题。
（6） 我们实现了PerDroid，并在此基础上，通过不断的测试，研发了各个不同的小模块，以解决测试过程中遇到的工程性问题。这使得我们的工具能真正运行在实际的应用场景中。


\todo{
RunDroid以帮助用户（开发人员）了解Android应用程序的执行过程作为基本出发点，让Android应用在执行时输出相应的执行日志信息，进而利用这些日志信息恢复Android应用程序执行时的动态调用图。
在具体实现上，我们通过对源代码进行日志插桩的方式输出程序在应用层上的执行信息，利用Xposed可以改变Android系统行为的特性进行系统方法的拦截处理，从而记录Android系统内部的执行信息。
除了展示方法间的调用关系之外，RunDroid考虑到Android系统上的多线程调用场景，提供多线程触发关系展示的功能：RunDroid对日志进行初步处理，在Neo4j图数据库上构建程序调用图，根据具体的多线程调用规则结合Soot提供的实现类查询服务，生成对应的Cypher脚本语句，在对应的节点之间创建对应的触发关系，展现了方法间的多线程触发关系。
这个方案思路清晰简洁，可以从方法调用、方法间的触发关系、相关对象信息等多个方面较为全面地展现Android应用的执行过程，具有一定的通用性和拓展性。
}


\eat{
本文尝试提出一个Android动态函数调用图构建系统，从应用层和系统层对Android应用程序的执行过程进行记录，并利用得到的执行日志信息还原Android应用程序的动态函数调用图，从方法层面还原程序的执行过程。
另外，通过Android系统的源代码进行分析，我们可以找到Android应用程序中多线程相关的函数触发关系，进一步全面的展现Android应用程序的执行过程。
另外，开发人员还可以对系统进行拓展，实现自身的需求。
}

\section{展望}

本文致力于还原Android应用程序的动态函数调用图，反映程序的运行时状态，虽然取得了一定的研究成果，但在实验过程中仍然发以下问题：

（1）RunDroid在捕获应用用户层方法时，采用的方案是源代码插桩方案。
调用图构建的前置条件需要提供Android 应用的源代码。
系统运行对源代码高度依赖，现在阶段的RunDroid更适用于企业开发环境，和工业生产环境下应用还存在一定的距离。

（2）在实验阶段，我们发现，当应用程序长时间运行时，应用程序会产生较多的日志。
通常的，移动设备上的存储是有限的。
因此，对于一些调用关系较为复杂的应用，RunDroid的日志方案比较容易遇到日志存储的瓶颈。

（3）RunDroid中的运行时拦截器是基于Xposed框架实现的。Xposed框架并不是适用于所有的Android手机，在一定程度给RunDroid的实验环境提出了额外的要求。

整体上，本文提出的RunDroid较为准确地还原出Android应用程序在运行过程的函数调用图。
主要的改进方法：利用字节码修改技术代替源代码修改方案以减少RunDroid运行过程中对源代码的依赖；
引入基于JVMTI的调试环境，借助调试技术实现系统方法执行的拦截，摆脱对Xposed环境的依赖；
通过静态分析技术确定运行过程的确定性路径，缩减待插桩的用户方法数量，进而减少运行时日志的产出量，同时在构建函数姐需要等。