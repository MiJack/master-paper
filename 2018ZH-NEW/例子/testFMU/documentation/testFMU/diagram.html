<html>
<head>

<style type="text/css">
  html, body {
    height: 100%;
    overflow: hidden;
  }
  body {
    padding: 0;
    margin: 0;
  }
  #silverlightControlHost {
    width: 100%;
    height: 100%;
  }
</style>

<script type="text/javascript">
// Global variables
var componentClassArray = [];
var availablePages = [':information','_,',':variables','_,'];
var panningEnabled_ = false;
var panningPerformed_ = false;
var mouseX_;
var mouseY_;
var previouslySelectedComponentName_ = "";
var selectedComponentName_ = "";
var visibleSection_ = "information";
var mouseClickTimeStamp_ = 0;

function getComponentClassName(componentIdentifier) {
  for (var i = 0; i < componentClassArray.length; i += 2) {
    if (componentClassArray[i] == ":" + componentIdentifier) {
      return componentClassArray[i + 1];
    }
  }
  return "";
}

function existsPage(pageType, identifier) {
  for (var i = 0; i < availablePages.length; i += 2) {
    if (availablePages[i] == ":" + pageType) {
      return ((availablePages[i + 1]).search(identifier + ",") != -1);
    }
  }
  return false;
}

function isDoubleClick() {
  var currentDate = new Date();
  var delta = currentDate.getTime() - mouseClickTimeStamp_;
  mouseClickTimeStamp_ = currentDate.getTime();
  return delta < 500;
}

//
// Sets the currently visible section in the contentsFrame.
//
function setVisibleSection(section) {
  visibleSection_ = section;
}

function enablePanning(sender, mouseEventArgs) {
  mouseX_ = mouseEventArgs.getPosition(null).x;
  mouseY_ = mouseEventArgs.getPosition(null).y;
  panningEnabled_ = true;
  panningPerformed_ = false;
}
function disablePanning(sender, mouseEventArgs) {
  // Deselect any selected component if no panning was performed.
  if (panningEnabled_ && !panningPerformed_) {
    if (selectedComponentName_ != "") {
      selectionArea = sender.FindName(selectedComponentName_ + "SelectionMask");
      selectionArea.Fill = "Transparent";
    }
    previouslySelectedComponentName_ = selectedComponentName_;
    selectedComponentName_ = "";
    top.frames['menuFrame'].location = "_menu.html";
    if (visibleSection_ == "results") {
      top.frames['contentFrame'].location = "_results.html";
    } else {
      if (existsPage(visibleSection_, '_')) {
        top.frames['contentFrame'].location = "_" + visibleSection_ + ".html";
      } else {
        top.frames['contentFrame'].location = "../_resources/na_" + visibleSection_ + ".html";
      }
    }
  }
  panningEnabled_ = false;
}
function performPanning(sender, mouseEventArgs) {
  if (panningEnabled_) {
    var mouseX2 = mouseEventArgs.getPosition(null).x;
    var mouseY2 = mouseEventArgs.getPosition(null).y;
    Translate = sender.FindName("Translate");
    Translate.X = Translate.X + (mouseX2 - mouseX_) / 2.5;
    Translate.Y = Translate.Y + (mouseY2 - mouseY_) / 2.5;
    mouseX_ = mouseX2;
    mouseY_ = mouseY2;
    panningPerformed_ = true;
  }
}

//
// Increases the opacity of the navigation panel button and sets the fill
// attribute of the button mask specified as the sender.
//
// If the user is panning the view, this function does nothing.
//
function onNavigationPanelEnter(sender, args) {
  if (panningEnabled_) return;
  setNavigationPanelOpacity("1");
  sender.Fill = "Blue";
}

//
// Decreases the opacity of the navigation panel buttons and sets the fill
// attribute of the button mask specified as the sender.
//
// If the user is panning the view, this function does nothing.
//
function onNavigationPanelLeave(sender, args) {
  if (panningEnabled_) return;
  setNavigationPanelOpacity("0.25");
  sender.Fill = "Transparent";
}

function onLeftClicked(sender, args) {
  Translate = sender.FindName("Translate");
  Translate.X = Translate.X + 25;
}
function onUpClicked(sender, args) {
  Translate = sender.FindName("Translate");
  Translate.Y = Translate.Y + 25;
}
function onRightClicked(sender, args) {
  Translate = sender.FindName("Translate");
  Translate.X = Translate.X - 25;
}
function onDownClicked(sender, args) {
  Translate = sender.FindName("Translate");
  Translate.Y = Translate.Y - 25;
}
function onZoomInClicked(sender, args) {
  Scale = sender.FindName("Scale");
  Scale.ScaleX = Scale.ScaleX * 1.15; Scale.ScaleY = Scale.ScaleY * 1.15;
} 
function onZoomOutClicked(sender, args) {
  Scale = sender.FindName("Scale");
  Scale.ScaleX = Scale.ScaleX / 1.15; Scale.ScaleY = Scale.ScaleY / 1.15;
  if (Scale.ScaleX < 0) {
    Scale.ScaleX = 0; Scale.ScaleY = 0;
  }
} 
function onCenterClicked(sender, args) {
  Scale = sender.FindName("Scale");
  Scale.ScaleX = 1; Scale.ScaleY = 1;
  Translate = sender.FindName("Translate");
  Translate.X = 0; Translate.Y = 0;
}

function componentClicked(sender, args) {
  // Abort if no selection mask exists for the sender.
  if (!sender.FindName(sender.Name + "SelectionMask")) return;
  // Deselect previous component if any.
  if (selectedComponentName_ != "") {
    selectionArea = sender.FindName(selectedComponentName_ + "SelectionMask");
    selectionArea.Fill = "Transparent";
  }
  // Select component that was clicked.
  previouslySelectedComponentName_ = selectedComponentName_;
  selectedComponentName_ = sender.Name;
  selectionArea = sender.FindName(sender.Name + "SelectionMask");
  selectionArea.Fill = "Blue";
  if (isDoubleClick()  && selectedComponentName_ == previouslySelectedComponentName_ && selectedComponentName_ != "") {
    if (getComponentClassName(selectedComponentName_) != "") {
      if (top.location.href.lastIndexOf('/') > -1) {
        var newlocation = top.location.href;
        newlocation = newlocation.substr(0, newlocation.lastIndexOf('/'));
        top.location = newlocation.substr(0, newlocation.lastIndexOf('/')) + '/' + getComponentClassName(selectedComponentName_) + '/index.html';
      }
    }
  } else {
    top.frames['menuFrame'].location = sender.Name + "_menu.html";
    if (visibleSection_ == "results") {
      top.frames['contentFrame'].location = "_results.html";
    } else {
      if (existsPage(visibleSection_, sender.Name)) {
        top.frames['contentFrame'].location = sender.Name + "_" + visibleSection_ + ".html";
      } else {
        top.frames['contentFrame'].location = "../_resources/na_" + visibleSection_ + ".html";
      }
    }
  }
}

//
// Hides the transparent hover rectangle of the component canvas specified as the sender.
//
function onComponentLeave(sender, args) {
  componentMask = sender.FindName(sender.Name + "Mask");
  componentMask.Fill = "Transparent";
}

//
// Shows the transparent hover rectangle of the component canvas specified as the sender.
//
function onComponentEnter(sender, args) {
  componentMask = sender.FindName(sender.Name + "Mask");
  componentMask.Fill = "Gray";
}

//
// Sets the opacity of the navigation panel buttons to the specified value.
//
function setNavigationPanelOpacity(opacity) {
  obj = rootCanvas_.FindName("rightButton"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("rightButton-1"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("rightButton-2"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("upButton"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("upButton-1"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("upButton-2"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("leftButton"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("leftButton-1"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("leftButton-2"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("downButton"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("downButton-1"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("downButton-2"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("centerButton"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("centerButton-1"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("centerButton-2"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("centerButton-3"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("centerButton-4"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("zoomInButton"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("zoomInButton-1"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("zoomInButton-2"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("zoomOutButton"); obj.Opacity = opacity;
  obj = rootCanvas_.FindName("zoomOutButton-1"); obj.Opacity = opacity;
}

//
// Mouse wheel handler.
//
function onMouseWheelTurned(event) {
  var delta = 0;

  if (!event) {
    event = window.event;
  }

  if (event.wheelDelta) {
    delta = event.wheelDelta;
    if (window.opera) {
      delta = -delta;
    }
    else if (event.detail) {
      delta = -event.detail;
    }
    if (delta) {
      if (delta > 0) {
        onZoomInClicked(rootCanvas_);
      } else {
        onZoomOutClicked(rootCanvas_);
      }
    }
  }

  if (event.preventDefault) {
    event.preventDefault();
  }

  event.returnValue = false;
}

//
// Silverlight load handler.
//
function onSilverlightLoad(sender, args) {
  rootCanvas_ = sender;
  if (window.addEventListener) {
    window.addEventListener('DOMMouseScroll', onMouseWheelTurned, false);
  }
  window.onmousewheel = document.onmousewheel = onMouseWheelTurned;
}

//
// Silverlight error handler.
//
function onSilverlightError(sender, args) {
  var appSource = "";
  if (sender != null && sender != 0) {
    appSource = sender.getHost().Source;
  }
  var errorType = args.ErrorType;
  var iErrorCode = args.ErrorCode;

  var errMsg = "Unhandled Error in Silverlight 2 Application " + appSource + ", ";
  errMsg += "Code: " + iErrorCode + ", Category: " + errorType + ", Message: " + args.ErrorMessage;

  if (errorType == "ParserError") {
    errMsg += args.xamlFile + ", Ln " + args.lineNumber + ", Col " + args.charPosition + ", ";
  }
  else if (errorType == "RuntimeError") {
    if (args.lineNumber != 0) {
      errMsg += "Ln " + args.lineNumber + ", Col " + args.charPosition;
    }
    errMsg += "MethodName: " + args.methodName;
  }

  throw new Error(errMsg);
}
</script>
</head>

<body>
  <div id="silverlightControlHost">
    <object width="100%" height="100%" type="application/x-silverlight-2" data="data:application/x-silverlight-2,">
      <param name="source" value="diagram.xaml"/>
	    <param name="onload" value="onSilverlightLoad" />
      <param name="onerror" value="onSilverlightError" />
      <param name="background" value="white" />
      <param name="minRuntimeVersion" value="2.0.31005.0" />
      <param name="autoUpgrade" value="true" />
      <div style="margin-top: 25; margin-left: 25;">
        <a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;">
          <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none"/>
        </a>
      </div>
    </object>
    <!-- Prevent Safari to cache page -->
    <iframe style='visibility:hidden;height:0;width:0;border:0px'></iframe>
  </div>
</body>

</html>
